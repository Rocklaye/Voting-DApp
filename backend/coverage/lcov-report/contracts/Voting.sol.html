<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Voting.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Voting.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">19.23% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>5/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">22.73% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>10/44</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">36.36% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>4/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">20.51% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>8/39</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4√ó</span>
<span class="cline-any cline-yes">3√ó</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">9√ó</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8√ó</span>
<span class="cline-any cline-yes">8√ó</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7√ó</span>
<span class="cline-any cline-yes">7√ó</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3√ó</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.28;
&nbsp;
import "@openzeppelin/contracts/access/Ownable.sol";
&nbsp;
contract Voting is Ownable {
   // address private _owner;
&nbsp;
    struct Voter {
        bool isRegistered;
        bool hasVoted;
        uint votedProposalId;
    }
&nbsp;
    struct Proposal {
        string description;
        uint voteCount;
    }
&nbsp;
    // Enum√©ration des diff√©rents √©tats du vote
    enum WorkflowStatus {
        RegisteringVoters,           // Inscription des √©lecteurs
        ProposalsRegistrationStarted, // D√©but de l'enregistrement des propositions
        ProposalsRegistrationEnded,   // Fin de l'enregistrement des propositions
        VotingSessionStarted,         // D√©but de la session de vote
        VotingSessionEnded,           // Fin de la session de vote
        VotesTallied                  // Comptage des votes termin√©
    }
&nbsp;
    WorkflowStatus public status; //Variable de l'etat actuel des votes
    
    mapping (address =&gt; Voter) public voters; // Liste des √©lecteurs enregistr√©s (associ√©s √† leur adresse Ethereum)
&nbsp;
    Proposal[] public proposals; //Liste des propositions enregistrees
    uint public winningProposalId; // ID de la proposition gagnante
&nbsp;
&nbsp;
    //Evenements
    event VoterRegistered(address voterAddress); 
    event WorkflowStatusChange(WorkflowStatus previousStatus, WorkflowStatus newStatus);
    event ProposalRegistered(uint proposalId);
    event Voted (address voter, uint proposalId);
&nbsp;
    /* Modificateur qui restreint l'acc√®s √† l'admin
    modifier onlyOwner() {
        require(msg.sender == _owner, "Vous n'etes pas l'admin");
        _;
    }
    */
&nbsp;
    //Modificateur qui restreind l'acces juste aux electeurs inscrits
    modifier onlyRegisteredVoter() {
        require(voters[msg.sender].isRegistered, "Vous n'etes pas inscrit");
        _;
    }
&nbsp;
    //Constructeur du contrat
    constructor() Ownable(msg.sender) {
        status = WorkflowStatus.RegisteringVoters; // Initialise le workflow √† l'√©tat d'inscription des √©lecteurs
    }
&nbsp;
    // Fonction pour enregistrer un √©lecteur (uniquement accessible par l'administrateur)
    function registerVoter(address _voter) external onlyOwner {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(status == WorkflowStatus.RegisteringVoters, "L'inscription des electeurs est fermee");
        require(!voters[_voter].isRegistered, "Electeur deja inscrit");
&nbsp;
        voters[_voter] = Voter(true, false, 0); // Inscription de l'√©lecteur
        emit VoterRegistered(_voter); // √âmission d'un √©v√©nement
    }
&nbsp;
    // Fonction pour commencer l'enregistrement des propositions
<span class="fstat-no" title="function not covered" >    function startProposalsRegistration() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(status == WorkflowStatus.RegisteringVoters, "Mauvais etat du workflow")</span>;
<span class="cstat-no" title="statement not covered" >        emit WorkflowStatusChange(status, WorkflowStatus.ProposalsRegistrationStarted);</span>
        status = WorkflowStatus.ProposalsRegistrationStarted; // Mise √† jour de l'√©tat du vote
    }
&nbsp;
    //  Fonction pour soumettre une proposition (seuls les √©lecteurs inscrits peuvent proposer)
    function submitProposal(string calldata _description) external onlyRegisteredVoter {
        <span class="missing-if-branch" title="if path not taken" >I</span>require(status == WorkflowStatus.ProposalsRegistrationStarted, "Enregistrement des propositions ferme");
<span class="cstat-no" title="statement not covered" >        proposals.push(Proposal(_description, 0))</span>; // Ajoute une nouvelle proposition avec 0 vote
<span class="cstat-no" title="statement not covered" >        emit ProposalRegistered(proposals.length - 1);</span> // √âmission d'un √©v√©nement avec l'ID de la proposition
    }
&nbsp;
    //Fonction pour arr√™ter l'enregistrement des propositions
<span class="fstat-no" title="function not covered" >    function endProposalsRegistration() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(status == WorkflowStatus.ProposalsRegistrationStarted, "Mauvais etat du workflow")</span>;
<span class="cstat-no" title="statement not covered" >        emit WorkflowStatusChange(status, WorkflowStatus.ProposalsRegistrationEnded);</span>
        status = WorkflowStatus.ProposalsRegistrationEnded;
    }
&nbsp;
    //  **Fonction pour commencer la session de vote**
<span class="fstat-no" title="function not covered" >    function startVotingSession() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(status == WorkflowStatus.ProposalsRegistrationEnded, "Mauvais etat du workflow")</span>;
<span class="cstat-no" title="statement not covered" >        emit WorkflowStatusChange(status, WorkflowStatus.VotingSessionStarted);</span>
        status = WorkflowStatus.VotingSessionStarted;
    }
&nbsp;
     //  **Fonction pour voter pour une proposition(seuls les √©lecteurs inscrits peuvent voter)
<span class="fstat-no" title="function not covered" >    function vote(uint _proposalId) external onlyRegisteredVoter {</span>
<span class="cstat-no" title="statement not covered" >        require(status == WorkflowStatus.VotingSessionStarted, "La session de vote n'est pas ouverte")</span>;
<span class="cstat-no" title="statement not covered" >        require(!voters[msg.sender].hasVoted, "Vous avez deja vote")</span>;
<span class="cstat-no" title="statement not covered" >        require(_proposalId &lt; proposals.length, "ID de proposition invalide")</span>;
&nbsp;
        voters[msg.sender].hasVoted = true; // Marque l'√©lecteur comme ayant vot√©
        voters[msg.sender].votedProposalId = _proposalId; // Enregistre le vote
        proposals[_proposalId].voteCount++; // Incr√©mente le compteur de votes pour la proposition choisie
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit Voted(msg.sender, _proposalId);</span> // √âmission d'un √©v√©nement
    }
&nbsp;
    //  *onction pour fermer la session de vote
<span class="fstat-no" title="function not covered" >    function endVotingSession() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(status == WorkflowStatus.VotingSessionStarted, "Mauvais etat du workflow")</span>;
<span class="cstat-no" title="statement not covered" >        emit WorkflowStatusChange(status, WorkflowStatus.VotingSessionEnded);</span>
        status = WorkflowStatus.VotingSessionEnded;
    }
&nbsp;
     // üìå **Fonction pour comptabiliser les votes et d√©terminer le gagnant**
<span class="fstat-no" title="function not covered" >    function tallyVotes() external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(status == WorkflowStatus.VotingSessionEnded, "Les votes ne sont pas encore clos")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint winningVoteCount = 0;</span> // Initialisation du nombre de votes maximum
&nbsp;
        // Parcourt toutes les propositions pour trouver celle avec le plus de votes
<span class="cstat-no" title="statement not covered" >        for (uint i = 0; i &lt; proposals.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >            if (proposals[i].voteCount &gt; winningVoteCount) {</span>
                winningVoteCount = proposals[i].voteCount;
                winningProposalId = i;
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        emit WorkflowStatusChange(status, WorkflowStatus.VotesTallied);</span> // √âmission d'un √©v√©nement
        status = WorkflowStatus.VotesTallied; // Mise √† jour du statut du vote
    }
&nbsp;
    // üìå **Fonction pour r√©cup√©rer la proposition gagnante**
<span class="fstat-no" title="function not covered" >    function getWinner() external view returns (string memory) {</span>
<span class="cstat-no" title="statement not covered" >        require(status == WorkflowStatus.VotesTallied, "Le vote n'a pas encore ete comptabilise")</span>;
<span class="cstat-no" title="statement not covered" >        return proposals[winningProposalId].description;</span> // Retourne la description de la proposition gagnante
    }
    
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Mar 19 2025 09:19:06 GMT+0100 (heure normale d‚ÄôEurope centrale)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
